# Silver Hawk Trading - Project Guide

## Overview

Trading notification system built around a Telegram bot and a multi-agent analysis framework. All notifications, price alerts, and analysis results are delivered via Telegram.

Each user runs their own independent instance: own Telegram bot, own Supabase DB, own GitHub Actions. See `ONBOARDING.md` (DE) or `ONBOARDING_EN.md` (EN).

## Telegram Bot

- Credentials stored in `.env` (never committed to git)
- Each user creates their own bot via @BotFather

### Scripts

**`send_telegram.py`** - Helper module for sending Telegram messages and photos.
- `send_message(text, parse_mode='HTML')` - Send text message
- `send_photo(photo_path, caption='')` - Send photo with optional caption (multipart upload)
- CLI usage: `python send_telegram.py "Your message here"`

## Price Tracker (Personal)

Price tracker configs are personal and NOT committed to the repo (in `.gitignore`).

**`tracker_check_template.py`** - Template for price alerts. Copy and customize:
```bash
cp tracker_check_template.py tracker_check.py
# Edit SYMBOLS, ALERT_RULES, and TRADING_ZONES with your stocks
```

- `tracker_check.py` - Your personal config (gitignored), runs via GitHub Actions
- `price_tracker.py` - Local infinite-loop version (gitignored)
- State (prev_prices, alerted_levels) persisted in Supabase `tracker_state` table

### Alert Features
- Flash move: >1.5% change in 5 minutes
- Big daily move: >5% intraday change
- Price level crossings (per-symbol thresholds in `ALERT_RULES`)
- AI Trading Zones with context notes (in `TRADING_ZONES`)
- Silent hourly summaries, loud alerts for dramatic moves

### GitHub Actions
- Workflow: `.github/workflows/tracker.yml`
- Schedule: every 10 min during market hours (08:00-22:00 CET), every 30 min overnight
- Weekdays only

## Multi-Agent Analysis

Run with: `Analysiere <SYMBOL> @prompts/00_master.md`

Language defaults to German. Change `{{LANGUAGE}}` in `prompts/00_master.md` for English output.

4-step pipeline in `prompts/`:

| Step | File | Agent Role |
|------|------|-----------|
| 1 | `01_data_collection.md` | yfinance data, chart, news, macro, ATR/volatility, short interest |
| 2 | `02_investment_debate.md` | Bull vs Bear debate (2 rounds) |
| 3 | `03_judge_risk.md` | Judge decision + confidence %, 3 risk analysts (ATR-based KO levels), position sizing matrix, stop-loss strategy |
| 4 | `04_summary_send.md` | Trading card, full analysis, JSON, chart upload, DB insert |

### Key Analysis Features
- **ATR-based KO planning:** ATR determines KO distance, NOT whether to trade
- **Position sizing matrix:** 4 scenarios (Lotto 50 EUR / Klein 150 EUR / Standard 300 EUR / Ohne Hebel 200 EUR)
- **Short interest analysis:** % of float, days to cover, squeeze potential
- **Mental stop-loss:** Always ABOVE KO level to limit losses to ~30% instead of 100%

### Chart Generation

Charts are generated by an external script and uploaded to Supabase storage:
- Script path in `.env` as `CHART_SCRIPT`
- Output dir in `.env` as `CHART_OUTPUT_DIR`
- Uploaded to Supabase storage bucket `charts/` (public)

## Supabase Database

Each user has their own Supabase project (free tier). Schema in `supabase/schema.sql`.

### Tables

| Table | Purpose |
|-------|---------|
| `reminders` | Analysis results (title, description, image_url, due_at, is_done) |
| `stocks` | Watchlist (symbol, price, RSI, SMAs, analyst_rating, etc.) |
| `tracker_state` | Price tracker state persistence (prev_prices, alerted_levels) |

### Storage
- Bucket `charts/` (public) for analysis chart images

## Environment

All secrets and paths are in `.env` (never committed to git):

```
TELEGRAM_BOT_TOKEN=...
TELEGRAM_CHAT_ID=...
TELEGRAM_BOT_USERNAME=...
SUPABASE_URL=...
SUPABASE_ANON_KEY=...
YFINANCE_VENV=...          # Optional: path to python3 in trading-crew venv
CHART_SCRIPT=...            # Optional: path to chart generation script
CHART_OUTPUT_DIR=...        # Optional: path to chart output directory
```

**`supabase_client.py`** - Shared Supabase client module. Loads `.env` and provides `supabase_request()`.

## Stock Watchlist

Curated watchlist in Supabase `stocks` table, updated automatically via GitHub Actions.

### Scripts

**`admin_stocks.py`** - Admin CLI for managing the watchlist.
- `python admin_stocks.py list` - Show all stocks
- `python admin_stocks.py add NVDA "NVIDIA" Technology` - Add a stock
- `python admin_stocks.py remove NVDA` - Deactivate (soft delete)
- `python admin_stocks.py seed` - Seed initial watchlist

**`update_stocks.py`** - Fetches yfinance data and updates Supabase.
- Updates: price, change_pct, RSI, SMA50, SMA200, market_cap, volume, analyst_rating
- Workflow: `.github/workflows/update_stocks.yml` (every 30 min during market hours)

**`browse_stocks.py`** - Read-only watchlist browser.
- `python browse_stocks.py` - Formatted table grouped by sector
- `python browse_stocks.py --json` - JSON output

## GitHub Actions

| Workflow | File | Schedule | Purpose |
|----------|------|----------|---------|
| Stock Updater | `update_stocks.yml` | Every 30 min (market hours) | Update prices, RSI, SMAs |
| Price Tracker | `tracker.yml` | Every 10 min (market hours) | Price alerts via Telegram |

Secrets needed: `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`, `SUPABASE_URL`, `SUPABASE_ANON_KEY`

## Onboarding

Friends fork the repo and set up their own independent instance. See:
- `ONBOARDING.md` - German setup guide
- `ONBOARDING_EN.md` - English setup guide
- `.env.template` - Environment config template
